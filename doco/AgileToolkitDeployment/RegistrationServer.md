The technique I use for having a "zero trust policy" is to use Cloudflare Access to require a one time passcode before any access to the web property is granted. This will require that only people with an email address for the domain of the website will be able to receive access codes for the web property. Therefore by controlling who has email addresses for that domain you control who has access to the website. This cuts out a whole load of potential hacks from scripts and whatnot. It does mean that the onboarding process for new users requires the setting up of email routing (using the new cloudflare email routing service), before they can access your website to be able to register for it. So, like everything it is a trade off, you can't just have "unknowns" registering for your site, but, you get the additional security of a zero trust barrier. The aim of my toolkit though is to be agile in other words, not tightly coupled to any provider and this would tightly couple us to cloudflare. What I describe below is a potential solution to decouple from cloudflare and I call it the "registration server" approach whcih is possible with this toolkit. Being agile means that you aare maximally resilient and that is what I was trying to achieve here. The old saying is, "don't put all your websites in one basket".

--------------------

##POTENTIAL REGISTRATION SERVER APPROACH TO ZERO TRUST

Naked DNS systems don't have as much security protection for your website as if you route through a proxy service like Cloudflare. Cloudflare is the only proxy service I support with this toolkit at the moment, but, if you want to extend it to support another, you are more than welcome. The rest of the DNS systems are just naked DNS systems and I wanted to do what I could to bolster the fortifications if such a solution were to be used. 

The idea is to use this software for serious systems which means I am looking for ways to make the system as secure as possible.
One option is the [Gateway Guardian](https://github.com/agile-deployer/agile-infrastructure-build-client-scripts/blob/master/doco/AgileToolkitDeployment/GatewayGuardian.md) technique but, if you want to gateway off your whole application then how do new users gain access to your webproperty?
 
The registration server I envision would work as follows:

1. Entirely seperate registration server which allows connections only from authorised application servers deployed using the ADT or that the ADT is authorised to poll for new registrations.
2. To login to the main application, a user needs to first authenticate to the registration server. Upon a successful authentication, the ip address of the user's connecting  client machine is recorded (in the database of the registration server or even an S3 bucket that the ADT has access to if you preferred).
3. Every 5 seconds, the adt deployed application webservers poll the registration server for new authorised ip addresses and punches a hole in their firewalling for ports 443 and 80 such that within 5 seconds for authorised ips, the webservers of the application are then open to that ip address. Ultimately, there will be a list of ip addresses with access to each application and no other ip addresses will be able to access anything because of the firewall. Once the firewall has been opened up to the user's ip address, the registration server redirects to the application server's login page and the user authenticates to the application then. Preferably the firewalling will be native firewalling from the cloudhost (but if this is not possible) then ufw can be used and is already supported. Using such a system would make your servers much less reliant on modsecurity and so on to filter out bad requests because there shouldn't really be any. 

What this would mean is that ports 443 and 80 are firewalled off by default and only once you trust someone (they authenticate to your registration server) is their ip address granted access. I haven't implemented this yet, but, that's the basic outline of the idea, maybe you can help me by having a go at implementing it?

