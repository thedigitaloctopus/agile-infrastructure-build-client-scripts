Naked DNS systems don't have as much security protection for your website as if you route through a proxy service like Cloudflare. Cloudflare is the only proxy service I support with this toolkit at the moment, but, if you want to extend it to support another, you are more than welcome. The rest of the DNS systems are just naked DNS systems and I wanted to do what I could to bolster the fortifications if such a solution were to be used. 

The idea is to use this software for serious systems which means I am looking for ways to make the system as secure as possible.
One option is the [Gateway Guardian](https://github.com/agile-deployer/agile-infrastructure-build-client-scripts/blob/master/doco/AgileToolkitDeployment/GatewayGuardian.md) technique but, if you want to gateway off your whole application then how do new users gain access to your webproperty?

1. One way they can gain access is if you do manual registrations. This might be the case if you know who all your application users are and as an administrator you set up their accounts for them and then inform them of their credentials (including their gateway guardian password). This can work for some scenarios.

2. A second way is to have an entirely separate registration server which is granted access to your application servers or that your application servers poll where new users register for your application by giving bare minimum information (name, username and email). Behind the scenes then, the registration server would tell your application server (your main website) that a new registration has taken place and register a new user manually using a technique similar to: [example](https://github.com/agile-deployer/agile-infrastructure-webserver-scripts/blob/master/providerscripts/application/processing/joomla/PerformPostProcessing.sh) around about line 150. The user that has registered with your registration server would be told to wait 5 minutes and then check their email where they will have a copy of their gateway guardian password as well as their actual registration password and username that your application server has generated (which you can require them to change on first login). This will mean that you can gateway guardian off your whole application whilst still making it possible for your users to gain initial access to your web property. Using this technique means that the "world facing" part of your system is only the registration server which only stores the username and email address of your users so is not so security critical. Of course, you still secure your registration server. Depending on the sophistication of your users, you could require that your users enter the ip address that they want to connect to your application server from and your webservers could be completely firewalled off except for the ip addresses that your users request access from through the registration server. This is an alternative way of controlling access but each time your user's ip address changes they would have to revisit your (2FA protected registration server) and update the ip address they want access through and to wait for the firewall to update on your webservers. 

To sum up the registration server I envision would work as follows:

1. Entirely seperate registration server which allows connections only from authorised application servers deployed using the ADT.
2. To login to the main application, a user needs to first authenticate to the registration server. Upon a successful authentication, the ip address of the user's connecting machine is recorded (in the database or even the file system if you wanted).
3. Every 5 seconds, the adt deployed application server polls the registration server for new authorised ip addresses and punches a hole in its firewalling for ports 443 and 80 such that within 5 seconds for authorised ips, the webservers of the application are then open to that ip address. Ultimately, there will be a list of ip addresses with access to each application and no other ip addresses will be able to access anything because of the firewall. Once the firewall has been opened up to the user's ip address, the registration server redirects to the application server's login page and the user authenticates to the application then. Preferably the firewalling will be native firewalling from the cloudhost (but if this is not possible) then ufw can be used and is already supported.

